<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/components/sphere-collider.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.controls.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/physx@v0.2.0/dist/physx.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.4.3/dist/aframe-blink-controls.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.11/build/handy-controls.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.11/build/magnet-helpers.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/aframe-htmlmesh@2.4.0/build/aframe-html.min.js"></script>
        <script src="ar-shadow-helper.js"></script>
        <script src="ar-cursor.js"></script>
        <script src="simple-navmesh-constraint.js"></script>
        <script src="model-utils.js"></script>
        <script src="script.js"></script>
    </head>
    <body>
        <audio id="background-music" src="familyguy.mp3" loop autoplay></audio>
        <a-scene     
        physx="autoLoad: true; delay: 1000; wasmUrl: https://cdn.jsdelivr.net/gh/c-frame/physx@v0.2.0/wasm/physx.release.wasm; useDefaultScene: false;"
        webxr="overlayElement:#dom-overlay;"
        background="color:skyblue;"
        reflection="directionalLight:#dirlight;"
        renderer="alpha:true;physicallyCorrectLights:true;colorManagement:true;exposure:2;toneMapping:ACESFilmic;"
        ar-hit-test="target:#my-ar-objects;type:footprint;footprintDepth:0.2;"
        shadow="type: pcfsoft"
        gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/versioned/decoders/1.5.7/;"
        ar-cursor raycaster="objects: #my-ar-objects a-sphere"
        xr-mode-ui="XRMode:xr">

    <a-entity
        id="cameraRig"
        simple-navmesh-constraint="navmesh:.navmesh;fall:0.5;height:0;exclude:.navmesh-hole;"
        movement-controls="speed:0.15;camera:#head;"
        position="-1 0 1" rotation="0 45 0" origin-on-ar-start
    >


            <!-- camera rig -->
        <a-entity id="head"
        camera="near:0.01;"
        look-controls="pointerLockEnabled: false"
        position="0 1.65 0"
      ></a-entity>

       <a-entity handy-controls="right:#right-gltf;materialOverride:right;" material="color:gold;metalness:1;roughness:0;"></a-entity>

        <a-gltf-model src="#watch-gltf" data-left="wrist" position="-1000 0 0">
          <a-sphere radius="0.02" position="0 0.02 0" sphere-collider="radius:0.02;objects:[data-right$=-tip];" exit-on="hitend" visible="false"></a-sphere>
        </a-gltf-model>

        <a-entity data-left="ring-finger-phalanx-proximal">
          <a-torus position="0 0 -0.03" radius="0.008" radius-tubular="0.001" scale="1 1 1.5" material="color:gold;metalness:1;roughness:0;"></a-torus>
        </a-entity>

            <a-assets>
                <a-asset-item id="peter" src="./peter.glb"></a-asset-item>
                <a-asset-item id="stewie" src="./stewie.glb"></a-asset-item>
                <a-asset-item id="lois" src="./lois.glb"></a-asset-item>
                <a-asset-item id="livingroom" src="./livingroom.glb"></a-asset-item>
                <a-asset-item id="chris" src="./chris.glb"></a-asset-item>
                <a-asset-item id="meg" src="./meg.glb"></a-asset-item>
                <a-asset-item id="brian" src="./brian.glb"></a-asset-item>
            </a-assets>

            <!-- Sky -->
            <a-sky color="#87CEEB"></a-sky>

            <!-- Ground -->
                <a-box position="0 -0.5 0" width="50" height="0.01" depth="50" 
                   color="#7BC8A4" 
                   material="roughness: 0.8; opacity: 0.3; transparent: true; alphaTest: 0.1; side: double"
                   static-body shadow="receive: true"
                   light-spawner>
            </a-box>

            <!-- 3D Characters with interaction -->
            <a-entity 
                gltf-model="#peter" 
                position="-10 0 -2.6" 
                scale="3.5 3.5 3.5"
                rotation="0 45 0"
                character-info="name: Peter Griffin; description: The lovable oaf patriarch of the Griffin family!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <a-entity 
                gltf-model="#stewie" 
                position="10 2 8" 
                scale="2.9 2.9 2.9"
                rotation="0 -110 0"
                character-info="name: Stewie Griffin; description: The diabolical baby genius with world domination plans!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <a-entity 
                gltf-model="#lois" 
                position="-11 0 2.2" 
                scale="3 3 3"
                rotation="0 90 0"
                character-info="name: Lois Griffin; description: The patient wife and mother trying to keep the family together!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <a-entity 
                gltf-model="#livingroom" 
                position="0 0 0" 
                scale="0.5 0.5 0.5"
                rotation="0 0 0"
                static-body>
            </a-entity>

            <a-entity 
                gltf-model="#chris" 
                position="4.2 0 9" 
                scale="3.2 3.2 3.2"
                rotation="0 -180 0"
                character-info="name: Chris Griffin; description: The awkward teenage son with a heart of gold!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <a-entity 
                gltf-model="#meg" 
                position="5.2 0 -5.8" 
                scale="3.2 3.2 3.2"
                rotation="0 -45 0"
                character-info="name: Meg Griffin; description: The often-ignored teenage daughter of the family!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <a-entity 
                gltf-model="#brian" 
                position="11.6 0 5.7" 
                scale="320 320 320"
                rotation="0 -90 0"
                character-info="name: Brian Griffin; description: The intellectual family dog with a martini habit!"
                static-body="shape: box"
                shadow="cast: true">
            </a-entity>

            <!-- UI Instructions -->
            <a-text position="-2 6 -5" 
                    value="Family Guy VR Experience\nUse WASD to move\nSpacebar to jump\nLook at characters and click to interact!"
                    color="#333333" 
                    width="8">
            </a-text>

        </a-scene>
    </body>
</html>